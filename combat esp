local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

local LocalPlayer = Players.LocalPlayer

_G.TEAMcheck1 = true -- true = don't ESP your team
_G.ESPColor = Color3.fromRGB(255, 0, 0)

local function CreateESP(player)
	local espBox = Drawing.new("Square")
	espBox.Visible = false
	espBox.Color = _G.ESPColor
	espBox.Thickness = 2
	espBox.Filled = false

	RunService.RenderStepped:Connect(function()
		if not _G.ESPEnabled then
			espBox.Visible = false
			return
		end

		if not player.Character then
			espBox.Visible = false
			return
		end

		local root = player.Character:FindFirstChild("HumanoidRootPart")
		local humanoid = player.Character:FindFirstChild("Humanoid")

		if not root or not humanoid or humanoid.Health <= 0 then
			espBox.Visible = false
			return
		end

		--  TEAM CHECK
		if _G.TEAMcheck1
     and player.Team == LocalPlayer.Team then
			espBox.Visible = false
			return
		end

		local screenPos, onScreen = Camera:WorldToViewportPoint(root.Position)
		if onScreen then
			espBox.Size = Vector2.new(50, 50)
			espBox.Position = Vector2.new(screenPos.X - 25, screenPos.Y - 25)
			espBox.Visible = true
		else
			espBox.Visible = false
		end
	end)
end

-- Existing players
for _, player in ipairs(Players:GetPlayers()) do
	if player ~= LocalPlayer then
		CreateESP(player)
	end
end

-- New players
Players.PlayerAdded:Connect(function(player)
	if player ~= LocalPlayer then
		CreateESP(player)
	end
end)
